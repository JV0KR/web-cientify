<div class="perfil-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>Cargando perfil...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="alert alert-success">
    {{ success }}
  </div>

  <!-- Perfil View -->
  <div *ngIf="!loading && user && !isEditing" class="profile-view">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-cover"></div>

      <div class="profile-info">
        <!-- Avatar -->
        <div class="avatar-container">
          <div class="avatar" [ngStyle]="{ backgroundColor: getRolColor() }">
            <img *ngIf="user.avatarUrl" [src]="user.avatarUrl" alt="{{ user.nombre }}" />
            <span *ngIf="!user.avatarUrl">{{ getInitials() }}</span>
          </div>
        </div>

        <!-- User Info -->
        <div class="user-info">
          <h1>{{ user.nombre }}</h1>
          <p class="email">{{ user.email }}</p>
          <div class="rol-badge" [ngStyle]="{ backgroundColor: getRolColor() }">
            {{ user.rol | uppercase }}
          </div>
          <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
          <p class="joined-date">Miembro desde {{ formatDate(user.createdAt) }}</p>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
          <div class="stat">
            <span class="stat-label">Seguidores</span>
            <span class="stat-value">{{ user.followersCount || 0 }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Siguiendo</span>
            <span class="stat-value">{{ user.followingCount || 0 }}</span>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="profile-actions">
        <button class="btn btn-primary" (click)="toggleEdit()">
          ‚úèÔ∏è Editar Perfil
        </button>
        <button class="btn btn-danger" (click)="logout()">
          üö™ Cerrar Sesi√≥n
        </button>
      </div>
    </div>

    <!-- Tabs Section (Future: posts, guardados, etc) -->
    <div class="profile-tabs">
      <div class="tab-content">
        <p class="placeholder">Aqu√≠ ir√°n tus publicaciones...</p>
      </div>
    </div>
  </div>

  <!-- Edit Profile Form -->
  <div *ngIf="!loading && user && isEditing" class="profile-edit">
    <div class="edit-header">
      <h2>Editar Perfil</h2>
      <button class="close-btn" (click)="cancelEdit()">‚úï</button>
    </div>

    <form (ngSubmit)="saveProfile()" class="edit-form">
      <!-- Avatar Upload -->
      <div class="form-section">
        <h3>Foto de Perfil</h3>
        <div class="avatar-upload">
          <div class="avatar-preview" [ngStyle]="{ backgroundColor: getRolColor() }">
            <img
              *ngIf="avatarPreview"
              [src]="avatarPreview"
              alt="Preview"
            />
            <img
              *ngIf="!avatarPreview && user.avatarUrl"
              [src]="user.avatarUrl"
              alt="{{ user.nombre }}"
            />
            <span *ngIf="!avatarPreview && !user.avatarUrl">
              {{ getInitials() }}
            </span>
          </div>
          <div class="upload-area">
            <input
              type="file"
              accept="image/*"
              (change)="onAvatarSelected($event)"
              class="file-input"
              id="avatar-input"
            />
            <label for="avatar-input" class="upload-label">
              üì∏ Cambiar foto de perfil
            </label>
            <p class="upload-hint">JPG, PNG. M√°ximo 5MB</p>
          </div>
        </div>
      </div>

      <!-- Basic Info -->
      <div class="form-section">
        <h3>Informaci√≥n B√°sica</h3>

        <div class="form-group">
          <label>Nombre Completo *</label>
          <input
            type="text"
            [(ngModel)]="editForm.nombre"
            name="nombre"
            required
            minlength="3"
            maxlength="100"
            placeholder="Tu nombre completo"
            class="form-control"
          />
          <small *ngIf="editForm.nombre.length < 3" class="error-text">
            El nombre debe tener al menos 3 caracteres
          </small>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input
            type="email"
            [(ngModel)]="editForm.email"
            name="email"
            required
            email
            placeholder="tu@email.com"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Rol</label>
           <div class="form-control-static">
             <span class="badge" [ngStyle]="{ backgroundColor: getRolColor() }">
               {{ user.rol | uppercase }}
             </span>
           </div>
           <small class="form-hint">
             El rol es asignado por un administrador
           </small>
        </div>
      </div>

      <!-- Biography -->
      <div class="form-section">
        <h3>Biograf√≠a</h3>
        <div class="form-group">
          <label>Sobre ti</label>
          <textarea
            [(ngModel)]="editForm.bio"
            name="bio"
            maxlength="500"
            rows="5"
            placeholder="Cu√©ntanos sobre ti, tus intereses cient√≠ficos, especialidades..."
            class="form-control"
          ></textarea>
          <small class="char-count">
            {{ editForm.bio.length }}/500
          </small>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="submit"
          [disabled]="!editForm.nombre || !editForm.email || editForm.nombre.length < 3 || loading"
          class="btn btn-primary btn-large"
        >
          {{ loading ? 'Guardando...' : 'üíæ Guardar Cambios' }}
        </button>
        <button
          type="button"
          (click)="cancelEdit()"
          [disabled]="loading"
          class="btn btn-secondary btn-large"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
